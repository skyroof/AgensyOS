
import asyncio
import os
import sys

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ path
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

from src.utils.pdf_generator import generate_pdf_report

async def test_pdf_generation():
    print("üöÄ Starting PDF generation test...")
    
    # Mock data
    user_name = "–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤"
    role_name = "Product Manager"
    experience = "Middle (3-5 –ª–µ—Ç)"
    
    scores = {
        "total": 72,
        "hard_skills": 7.5,
        "soft_skills": 8.0,
        "thinking": 6.5,
        "mindset": 7.0,
    }
    
    raw_averages = {
        "expertise": 7.2,
        "methodology": 6.8,
        "tools_proficiency": 8.5,
        "articulation": 9.0,
        "self_awareness": 7.5,
        "conflict_handling": 6.0,
        "depth": 6.5,
        "structure": 7.0,
        "systems_thinking": 6.0,
        "creativity": 8.0,
        "honesty": 9.5,
        "growth_orientation": 7.0,
    }
    
    benchmark_data = {
        "avg_score": 65.0,
        "percentile": 82,
        "total_sessions": 150,
        "insights": ["–¢—ã –≤ —Ç–æ–ø-20%!", "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –Ω–∞ 7 –±–∞–ª–ª–æ–≤"],
    }
    
    pdp_data = {
        "main_focus": "–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫ Data-Driven –ø–æ–¥—Ö–æ–¥—É –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.",
        "primary_goals": [
            {
                "metric_name": "Data Analytics",
                "current_score": 6.5,
                "target_score": 8.0,
                "priority_reason": "–ö–ª—é—á–µ–≤–æ–π –Ω–∞–≤—ã–∫ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Senior –ø–æ–∑–∏—Ü–∏—é. –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π.",
                "actions": ["–ü—Ä–æ–π—Ç–∏ –∫—É—Ä—Å –ø–æ SQL", "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ Amplitude", "–ü—Ä–æ–≤–æ–¥–∏—Ç—å A/B —Ç–µ—Å—Ç—ã –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ"],
                "resources": [{"type": "course", "title": "GoPractice"}, {"type": "tool", "title": "Tableau"}]
            },
            {
                "metric_name": "Strategic Thinking",
                "current_score": 6.0,
                "target_score": 7.5,
                "priority_reason": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞.",
                "actions": ["–°–æ—Å—Ç–∞–≤–∏—Ç—å Roadmap –Ω–∞ 12 –º–µ—Å—è—Ü–µ–≤", "–ò–∑—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤"],
                "resources": [{"type": "book", "title": "Good Strategy Bad Strategy"}]
            },
            {
                "metric_name": "Conflict Resolution",
                "current_score": 6.0,
                "target_score": 7.5,
                "priority_reason": "–í–∞–∂–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º–∏.",
                "actions": ["–ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–µ–Ω–∞—Å–∏–ª—å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è", "–ú–µ–¥–∏–∞—Ü–∏—è —Å–ø–æ—Ä–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ"],
                "resources": []
            }
        ],
        "plan_30_days": [
            "–ù–µ–¥–µ–ª—è 1: –ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç—Ä–∏–∫.",
            "–ù–µ–¥–µ–ª—è 1: –ê—É–¥–∏—Ç —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.",
            "–ù–µ–¥–µ–ª—è 2: –ü–µ—Ä–≤—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö.",
            "–ù–µ–¥–µ–ª—è 2: –í—Å—Ç—Ä–µ—á–∞ —Å–æ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º–∏ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.",
            "–ù–µ–¥–µ–ª—è 3: –ó–∞–ø—É—Å–∫ A/B —Ç–µ—Å—Ç–∞.",
            "–ù–µ–¥–µ–ª—è 3: –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ Roadmap.",
            "–ù–µ–¥–µ–ª—è 4: –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞.",
            "–ù–µ–¥–µ–ª—è 4: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –∫–≤–∞—Ä—Ç–∞–ª."
        ],
        "success_metrics": [
            "–ü—Ä–∏–Ω—è—Ç–æ 3 —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö",
            "–£—Ç–≤–µ—Ä–∂–¥–µ–Ω Roadmap –Ω–∞ –ø–æ–ª–≥–æ–¥–∞",
            "–ü—Ä–æ–≤–µ–¥–µ–Ω–æ 2 —É—Å–ø–µ—à–Ω—ã—Ö –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º–∏",
            "–í–Ω–µ–¥—Ä–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ —Ä–µ–≤—å—é –º–µ—Ç—Ä–∏–∫"
        ],
        "motivation_message": "üöÄ –¢—ã —É–∂–µ –ø—Ä–æ–¥–µ–ª–∞–ª –±–æ–ª—å—à—É—é —Ä–∞–±–æ—Ç—É! –≠—Ç–∏ —à–∞–≥–∏ –≤—ã–≤–µ–¥—É—Ç —Ç–µ–±—è –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å. –î–µ–π—Å—Ç–≤—É–π!"
    }
    
    report_text = """
1. <b>–û–ë–©–ï–ï –í–ü–ï–ß–ê–¢–õ–ï–ù–ò–ï</b>
–ê–ª–µ–∫—Å–µ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–º. –°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –∏ —ç–º–ø–∞—Ç–∏—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –û–¥–Ω–∞–∫–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≥–ª—É–±–∏–Ω—ã –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–º –º—ã—à–ª–µ–Ω–∏–∏.

2. <b>–°–ò–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´</b>
- –û—Ç–ª–∏—á–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏, —É–º–µ–µ—Ç —Å–ª—ã—à–∞—Ç—å –∫–æ–º–∞–Ω–¥—É.
- –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —ç–º–ø–∞—Ç–∏–∏ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ß–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –∫ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.
- –í–ª–∞–¥–µ–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (Jira, Notion, Figma).
- –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º.

3. <b>–ó–û–ù–´ –†–ê–ó–í–ò–¢–ò–Ø</b>
- –°–∏—Å—Ç–µ–º–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ: –∏–Ω–æ–≥–¥–∞ —É–ø—É—Å–∫–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏.
- –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏: –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ –∏–Ω—Ç—É–∏—Ü–∏—é –±–æ–ª—å—à–µ, —á–µ–º –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏: —Å–∫–ª–æ–Ω–µ–Ω –∏–∑–±–µ–≥–∞—Ç—å –æ—Å—Ç—Ä—ã—Ö —É–≥–ª–æ–≤.

4. <b>HARD SKILLS</b>
–£–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, —Ö–æ—Ä–æ—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ Agile/Scrum. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç—è–Ω—É—Ç—å —Ä–∞–±–æ—Ç—É —Å SQL –∏ Python –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

5. <b>SOFT SKILLS</b>
–ë–ª–µ—Å—Ç—è—â–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è. –õ–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç –æ–±—â–∏–π —è–∑—ã–∫. –°—Ç–æ–∏—Ç –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –∞—Å—Å–µ—Ä—Ç–∏–≤–Ω–æ—Å—Ç—å—é –≤ —Å–ª–æ–∂–Ω—ã—Ö –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞—Ö.

6. <b>–ú–´–®–õ–ï–ù–ò–ï</b>
–°–∫–ª–æ–Ω–µ–Ω –∫ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –º—ã—à–ª–µ–Ω–∏—é, –∏–Ω–æ–≥–¥–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –≤–∏–¥–µ–Ω–∏—è –Ω–∞ 1-2 –≥–æ–¥–∞ –≤–ø–µ—Ä–µ–¥.

7. <b>MINDSET</b>
Growth mindset —è—Ä–∫–æ –≤—ã—Ä–∞–∂–µ–Ω. –ò—Å–∫—Ä–µ–Ω–Ω–µ —Ö–æ—á–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è.

8. <b>–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò</b>
1. –ü—Ä–æ–π—Ç–∏ –∫—É—Ä—Å –ø–æ Product Analytics (GoPractice –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏).
2. –í–∑—è—Ç—å –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ —É Senior PM –¥–ª—è –ø—Ä–æ–∫–∞—á–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
3. –í–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫ —Ä–µ—à–µ–Ω–∏–π –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.

9. <b>–ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢</b>
–£–≤–µ—Ä–µ–Ω–Ω—ã–π Middle PM —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º —Ä–æ—Å—Ç–∞ –¥–æ Senior –∑–∞ 6-9 –º–µ—Å—è—Ü–µ–≤ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ Hard Skills.
"""

    try:
        pdf_bytes = generate_pdf_report(
            role_name=role_name,
            experience=experience,
            scores=scores,
            report_text=report_text,
            conversation_history=[],
            user_name=user_name,
            profile_data=None,
            pdp_data=pdp_data,
            benchmark_data=benchmark_data,
            raw_averages=raw_averages,
        )
        
        output_path = "test_report_v2.pdf"
        with open(output_path, "wb") as f:
            f.write(pdf_bytes)
            
        print(f"‚úÖ PDF successfully generated: {output_path}")
        print(f"üì¶ Size: {len(pdf_bytes) / 1024:.2f} KB")
        
    except Exception as e:
        print(f"‚ùå Error generating PDF: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    asyncio.run(test_pdf_generation())
