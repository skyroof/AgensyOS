"""
Кэшированные первые вопросы для мгновенного старта диагностики.
Убирает задержку на первом вопросе — AI не нужен.
"""
import random
from typing import Optional


# Кэш первых вопросов: role -> experience -> [варианты]
CACHED_FIRST_QUESTIONS: dict[str, dict[str, list[str]]] = {
    "designer": {
        "junior": [
            "Расскажи о проекте, которым ты гордишься больше всего. Что именно ты делал и какой был результат?",
            "Опиши свой типичный процесс работы над дизайн-задачей от начала до конца.",
            "Какой самый сложный дизайн-челлендж ты решал? Как подошёл к решению?",
            "Расскажи о ситуации, когда тебе пришлось защищать своё дизайн-решение. Как это было?",
            "Как ты обычно собираешь требования к дизайну? Приведи конкретный пример.",
        ],
        "middle": [
            "Опиши проект, где тебе пришлось работать в условиях неопределённости. Как справлялся?",
            "Расскажи о кейсе, где ты значительно улучшил UX продукта. Какие метрики изменились?",
            "Как ты выстраиваешь коммуникацию с разработчиками? Приведи пример сложной ситуации.",
            "Опиши ситуацию, когда твоё первоначальное решение оказалось неверным. Что сделал?",
            "Расскажи о самом масштабном редизайне, в котором участвовал. Какова была твоя роль?",
        ],
        "senior": [
            "Расскажи о проекте, где ты выступал лидом дизайн-направления. Как организовал процесс?",
            "Опиши кейс, где пришлось балансировать между бизнес-целями и пользовательским опытом.",
            "Как ты внедрял дизайн-систему в компании? С какими сложностями столкнулся?",
            "Расскажи о ситуации, когда ты менторил junior-дизайнера. Какой подход использовал?",
            "Опиши проект с высокими ставками, где ты принимал ключевые дизайн-решения.",
        ],
        "lead": [
            "Как ты выстраиваешь дизайн-культуру в команде? Приведи конкретные примеры инициатив.",
            "Расскажи о стратегическом проекте, где дизайн напрямую влиял на бизнес-метрики.",
            "Как ты оцениваешь и развиваешь дизайнеров в команде? Опиши свой фреймворк.",
            "Опиши ситуацию, где пришлось отстаивать дизайн-решение на уровне C-level.",
            "Расскажи о самой сложной трансформации дизайн-процессов, которую ты проводил.",
        ],
    },
    "product": {
        "junior": [
            "Расскажи о фиче, которую ты довёл от идеи до запуска. Какие этапы были?",
            "Как ты обычно приоритизируешь задачи в бэклоге? Приведи конкретный пример.",
            "Опиши ситуацию, когда тебе пришлось сказать 'нет' стейкхолдеру. Как аргументировал?",
            "Расскажи о продуктовой гипотезе, которую ты проверял. Какие были результаты?",
            "Как ты собираешь и анализируешь обратную связь от пользователей?",
        ],
        "middle": [
            "Опиши продукт или фичу, которая значительно повлияла на ключевые метрики. Как измерял успех?",
            "Расскажи о ситуации, когда данные противоречили интуиции. Какое решение принял?",
            "Как ты работаешь с техническим долгом vs новые фичи? Приведи пример баланса.",
            "Опиши кейс сложной коммуникации с несколькими стейкхолдерами с разными интересами.",
            "Расскажи о провале — запуске, который не оправдал ожиданий. Какие выводы сделал?",
        ],
        "senior": [
            "Как ты выстраиваешь продуктовую стратегию на 1-2 года? Опиши свой подход на примере.",
            "Расскажи о крупной продуктовой трансформации, которую ты возглавлял.",
            "Как ты балансируешь между инновациями и поддержкой существующего продукта?",
            "Опиши ситуацию, когда пришлось 'убить' фичу или продукт. Как принимал решение?",
            "Расскажи о опыте запуска продукта на новый рынок или сегмент.",
        ],
        "lead": [
            "Как ты формируешь и развиваешь продуктовую команду? Опиши свои принципы найма.",
            "Расскажи о влиянии продуктовых решений на P&L компании. Конкретные цифры?",
            "Как ты выстраиваешь product-led growth? Приведи примеры механик.",
            "Опиши опыт работы с board/инвесторами по продуктовым вопросам.",
            "Расскажи о самом масштабном pivote или смене стратегии продукта.",
        ],
    },
    "project": {
        "junior": [
            "Расскажи о самом сложном проекте, которым ты управлял. Какую методологию использовал?",
            "Опиши ситуацию, когда сроки проекта горели. Как ты приоритизировал задачи?",
            "Как ты обычно собираешь требования и формируешь Scope проекта?",
            "Расскажи о случае, когда стейкхолдер был недоволен ходом проекта. Как ты разрулил ситуацию?",
            "Как ты ведешь проектную документацию и отчетность? Приведи пример.",
        ],
        "middle": [
            "Опиши кейс управления проектом с жесткими ограничениями по бюджету и времени.",
            "Расскажи о ситуации, когда проект пошел не по плану. Как ты управлял изменениями (Change Management)?",
            "Как ты выстраиваешь коммуникацию в кросс-функциональной команде? Приведи пример конфликта интересов.",
            "Опиши опыт внедрения новой методологии (например, переход с Waterfall на Scrum) в проекте.",
            "Расскажи о проекте, где тебе удалось значительно сократить сроки или бюджет без потери качества.",
        ],
        "senior": [
            "Как ты управляешь портфелем проектов или программой? Опиши свой подход к распределению ресурсов.",
            "Расскажи о самом масштабном антикризисном управлении проектом в твоей карьере.",
            "Как ты выстраиваешь систему управления рисками на уровне всей компании или департамента?",
            "Опиши опыт работы с внешними подрядчиками и вендорами в критически важном проекте.",
            "Расскажи о ситуации, когда пришлось закрыть проект на полпути. Как ты обосновал это решение?",
        ],
        "lead": [
            "Как ты формируешь и развиваешь PMO (Project Management Office) или проектную культуру?",
            "Опиши свой опыт участия в стратегическом планировании компании через призму проектов.",
            "Как ты выстраиваешь Governance (систему управления) для крупных трансформационных проектов?",
            "Расскажи о влиянии твоих проектов на капитализацию или долгосрочную прибыль компании.",
            "Как ты менторишь других менеджеров проектов? Опиши свой подход к их развитию.",
        ],
    },
}


def get_cached_first_question(role: str, experience: str) -> Optional[str]:
    """
    Возвращает случайный первый вопрос из кэша.
    
    Args:
        role: Роль (designer/product)
        experience: Уровень опыта (junior/middle/senior/lead)
    
    Returns:
        Случайный вопрос из кэша или None если комбинация не найдена
    """
    role_questions = CACHED_FIRST_QUESTIONS.get(role, {})
    questions = role_questions.get(experience, [])
    
    if not questions:
        return None
    
    return random.choice(questions)


def get_all_first_questions(role: str, experience: str) -> list[str]:
    """Возвращает все варианты первого вопроса для комбинации."""
    return CACHED_FIRST_QUESTIONS.get(role, {}).get(experience, [])

